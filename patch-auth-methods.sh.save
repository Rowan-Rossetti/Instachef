#!/bin/bash

FILE="src/app/pages/auth-page/auth-page.component.ts"

echo "üîß Mise √† jour de $FILE ..."

# Supprime les anciennes versions (si d√©j√† l√†)
sed -i '' '/onLogin()/,/^  }/d' "$FILE"
sed -i '' '/onRegister()/,/^  }/d' "$FILE"

# Injecte les deux m√©thodes juste avant la fin de la classe
sed -i '' '/^}/i\
  onLogin(): void {\n\
    if (this.loginForm.invalid) return;\n\
    const email = this.loginForm.value.email ?? \x27\x27;\n\
    const password = this.loginForm.value.password ?? \x27\x27;\n\
    this.loading = true;\n\
    const success = this.authService.login(email, password);\n\
    this.loading = false;\n\
    if (success) {\n\
      this.snackBar.open(\x27Connexion r√©ussie ‚úÖ\x27, \x27Fermer\x27, { duration: 3000 });\n\
      setTimeout(() => {\n\
        this.router.navigateByUrl(\x27/accueil\x27);\n\
      }, 500);\n\
    } else {\n\
      this.snackBar.open(\x27√âchec de la connexion ‚ùå\x27, \x27Fermer\x27, { duration: 3000 });\n\
    }\n\
  }\n\
\n\
  onRegister(): void {\n\
    if (this.registerForm.invalid) return;\n\
    const username = this.registerForm.value.username ?? \x27\x27;\n\
    const email = this.registerForm.value.email ?? \x27\x27;\n\
    const password = this.registerForm.value.password ?? \x27\x27;\n\
    this.loading = true;\n\
    const success = this.authService.register(username, email, password);\n\
    this.loading = false;\n\
    if (success) {\n\
      this.snackBar.open(\x27Inscription r√©ussie ‚úÖ\x27, \x27Fermer\x27, { duration: 3000 });\n\
      setTimeout(() => {\n\
        this.router.navigateByUrl(\x27/accueil\x27);\n\
      }, 500);\n\
    } else {\n\
      this.snackBar.open(\x27√âchec de l‚Äôinscription ‚ùå\x27, \x27Fermer\x27, { duration: 3000 });\n\
    }\n\
  }
' "$FILE"

echo "‚úÖ M√©thodes onLogin et onRegister mises √† jour dans $FILE"

chmod +x patch-auth-methods.sh
'/Users/rowanrossetti/Documents/GitHub/Instachef/src/app/pages/auth-page/auth-page.component.ts'

